<app-navbar></app-navbar>

<div class="feed-container">
  
  <!-- Hero Header -->
  <div class="feed-hero">
    <div class="hero-content">
      <div class="hero-text">
        <h1>
          <span class="gradient-text">Descubre</span> lo que est√° viendo la comunidad
        </h1>
        <p>√önete a la conversaci√≥n sobre cine</p>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading-modern">
    <div class="loading-spinner">
      <div class="spinner-ring"></div>
      <div class="spinner-ring"></div>
      <div class="spinner-ring"></div>
    </div>
    <p class="loading-text">Cargando contenido incre√≠ble...</p>
  </div>

  <!-- Feed Grid -->
  <div *ngIf="!isLoading" class="feed-grid">
    
    <!-- Empty State Modern -->
    <div *ngIf="feedItems.length === 0" class="empty-state-modern">
      <div class="empty-animation">
        <div class="empty-circle"></div>
        <div class="empty-icon">üé≠</div>
      </div>
      <h2>El feed est√° esperando por ti</h2>
      <p>S√© el primero en compartir tu opini√≥n sobre pel√≠culas</p>
      <button class="btn-cta" routerLink="/movies/search">
        <span>Explorar Pel√≠culas</span>
        <span class="btn-arrow">‚Üí</span>
      </button>
    </div>

    <!-- Feed Items -->
    <article *ngFor="let item of feedItems; let i = index" 
             class="feed-item"
             [style.animation-delay.ms]="i * 50">
      
      <!-- Card Header -->
      <header class="item-header">
        <div class="user-info" [routerLink]="['/profile', item.user_id]">
          <div class="avatar-wrapper">
            <div class="user-avatar">
              {{ getUserInitials(item.user.username) }}
            </div>
            <div class="avatar-ring"></div>
          </div>
          <div class="user-meta">
            <span class="username">{{ item.user.username }}</span>
            <div class="meta-details">
              <span class="time">{{ getTimeAgo(item.created_at) }}</span>
              <span class="separator">‚Ä¢</span>
              <span class="activity-type">{{ getActivityBadge(item.activity_type) }}</span>
            </div>
          </div>
        </div>
        <div class="activity-icon-badge">
          {{ getActivityIcon(item.activity_type) }}
        </div>
      </header>

      <!-- Card Body -->
      <div class="item-body">
        
        <!-- Rating Activity -->
        <div *ngIf="item.activity_type === 'rating'" class="activity-content rating-activity">
          <div class="activity-title">
            <span class="action-text">calific√≥</span>
          </div>
          
          <div class="movie-showcase" [routerLink]="['/movies/detail', item.movie_tmdb_id]">
            <div class="movie-backdrop" *ngIf="item.movie_backdrop">
              <img [src]="getBackdropUrl(item.movie_backdrop)" [alt]="item.movie_title">
              <div class="backdrop-overlay"></div>
            </div>
            
            <div class="movie-content">
              <div class="movie-poster-mini">
                <img [src]="getImageUrl(item.movie_poster)" [alt]="item.movie_title">
              </div>
              <div class="movie-details">
                <h3 class="movie-title">{{ item.movie_title }}</h3>
                <div class="ratings-row">
                  <div class="rating-badge user-rating">
                    <span class="stars">‚≠ê</span>
                    <span class="value">{{ item.rating?.toFixed(1) }}</span>
                  </div>
                  <div class="rating-badge tmdb-rating" *ngIf="item.movie_rating_tmdb">
                    <span class="label">TMDB</span>
                    <span class="value">{{ item.movie_rating_tmdb.toFixed(1) }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Review Activity -->
        <div *ngIf="item.activity_type === 'review'" class="activity-content review-activity">
          <div class="activity-title">
            <span class="action-text">escribi√≥ una rese√±a</span>
          </div>
          
          <div class="review-showcase" [routerLink]="['/movies/detail', item.movie_tmdb_id]">
            <div class="review-header">
              <div class="review-poster">
                <img [src]="getImageUrl(item.movie_poster)" [alt]="item.movie_title">
                <div class="review-badge">üìù</div>
              </div>
              <div class="review-meta">
                <h3 class="movie-title">{{ item.movie_title }}</h3>
                <h4 class="review-title" *ngIf="item.review_title">{{ item.review_title }}</h4>
              </div>
            </div>
            
            <div class="review-body" *ngIf="!item.review_contains_spoilers">
              <p class="review-preview">{{ item.review_content }}</p>
              <div class="read-more">
                Leer m√°s <span class="arrow">‚Üí</span>
              </div>
            </div>
            
            <div class="spoiler-alert" *ngIf="item.review_contains_spoilers">
              <span class="alert-icon">‚ö†Ô∏è</span>
              <span class="alert-text">Contiene spoilers</span>
            </div>
          </div>
        </div>

        <!-- List Activity -->
        <div *ngIf="item.activity_type === 'list_created'" class="activity-content list-activity">
          <div class="activity-title">
            <span class="action-text">cre√≥ una lista</span>
          </div>
          
          <div class="list-showcase" [routerLink]="['/lists/detail', item.list_id]">
            <div class="list-icon-large">üìã</div>
            <div class="list-details">
              <h3 class="list-name">{{ item.list_name }}</h3>
              <p class="list-description" *ngIf="item.list_description">
                {{ item.list_description }}
              </p>
            </div>
            <div class="list-action">
              <span class="action-arrow">‚Üí</span>
            </div>
          </div>
        </div>

      </div>

      <!-- Card Footer -->
      <footer class="item-footer">
        <button class="footer-action" 
                [routerLink]="item.movie_tmdb_id ? ['/movies/detail', item.movie_tmdb_id] : ['/lists/detail', item.list_id]">
          <span>Ver detalles</span>
        </button>
        <div class="footer-meta">
          <button class="icon-btn">
            <span class="icon">‚ù§Ô∏è</span>
          </button>
          <button class="icon-btn">
            <span class="icon">üí¨</span>
          </button>
          <button class="icon-btn">
            <span class="icon">üîó</span>
          </button>
        </div>
      </footer>

    </article>

  </div>

  <!-- Pagination Modern -->
  <nav *ngIf="!isLoading && feedItems.length > 0 && totalPages > 1" class="pagination-modern">
    <button 
      class="page-btn prev"
      [disabled]="currentPage === 1"
      (click)="changePage(currentPage - 1)"
    >
      <span class="btn-icon">‚Üê</span>
      <span class="btn-text">Anterior</span>
    </button>

    <div class="page-indicators">
      <button
        *ngFor="let page of getPages()"
        class="page-indicator"
        [class.active]="page === currentPage"
        (click)="changePage(page)"
      >
        {{ page }}
      </button>
    </div>

    <button 
      class="page-btn next"
      [disabled]="currentPage === totalPages"
      (click)="changePage(currentPage + 1)"
    >
      <span class="btn-text">Siguiente</span>
      <span class="btn-icon">‚Üí</span>
    </button>
  </nav>

</div>