<app-navbar></app-navbar>

<div class="recommendations-container">
  <!-- Header -->
  <div class="recommendations-header">
    <h1>ğŸ¯ Recomendaciones para Ti</h1>
    <p>PelÃ­culas seleccionadas especialmente segÃºn tus gustos</p>
  </div>

  <!-- Algorithm Info -->
  <div *ngIf="selectedTab === 'personalized' && !isLoadingPersonalized && personalizedRecommendations && personalizedRecommendations.length > 0" class="algorithm-info">
    <div class="info-card">
      <span class="icon">{{ getAlgorithmIcon() }}</span>
      <div class="info-content">
        <strong>{{ getAlgorithmName() }}</strong>
        <p>Basado en {{ basedOnRatings }} calificaciones tuyas</p>
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button 
      class="tab-btn" 
      [class.active]="selectedTab === 'personalized'"
      (click)="changeTab('personalized')"
    >
      ğŸ¯ Personalizadas
    </button>
    <button 
      class="tab-btn" 
      [class.active]="selectedTab === 'genre'"
      (click)="changeTab('genre')"
    >
      ğŸ­ Por GÃ©nero
    </button>
  </div>

  <!-- PERSONALIZED TAB -->
  <div *ngIf="selectedTab === 'personalized'">
    <!-- Loading -->
    <div *ngIf="isLoadingPersonalized" class="loading">
      <div class="spinner"></div>
      <p>Generando recomendaciones personalizadas...</p>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoadingPersonalized && (!personalizedRecommendations || personalizedRecommendations.length === 0)" class="empty-state">
      <div class="empty-icon">ğŸ¬</div>
      <h2>Necesitamos saber mÃ¡s sobre tus gustos</h2>
      <p>Califica al menos 5 pelÃ­culas para recibir recomendaciones personalizadas</p>
      <button class="btn btn-primary" routerLink="/movies/search">
        Buscar PelÃ­culas para Calificar
      </button>
    </div>

    <!-- Movies Grid -->
    <div *ngIf="!isLoadingPersonalized && personalizedRecommendations && personalizedRecommendations.length > 0" class="movies-grid">
      <div *ngFor="let movie of personalizedRecommendations" class="movie-card">
        <div class="movie-poster" [routerLink]="['/movies/detail', movie.movie_tmdb_id]">
          <img 
            *ngIf="movie.poster_path" 
            [src]="getImageUrl(movie.poster_path)" 
            [alt]="movie.title"
          />
          <div *ngIf="!movie.poster_path" class="no-poster">ğŸ¬</div>

          <!-- Match Score Badge -->
          <div class="match-badge" [style.background-color]="getScoreColor(movie.score)">
            {{ movie.score }}% Match
          </div>

          <div class="movie-overlay">
            <div class="movie-rating" *ngIf="movie.vote_average">
              â­ {{ movie.vote_average.toFixed(1) }}
            </div>
          </div>
        </div>

        <div class="movie-info">
          <h3 [routerLink]="['/movies/detail', movie.movie_tmdb_id]">{{ movie.title }}</h3>
          <p class="movie-year" *ngIf="movie.release_date">
            {{ movie.release_date.substring(0, 4) }}
          </p>
          <p class="reason" *ngIf="movie.reason">{{ movie.reason }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- TRENDING TAB -->
  <div *ngIf="selectedTab === 'trending'">
    <!-- Loading -->
    <div *ngIf="isLoadingTrending" class="loading">
      <div class="spinner"></div>
      <p>Cargando tendencias...</p>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoadingTrending && (!trendingRecommendations || trendingRecommendations.length === 0)" class="empty-state">
      <div class="empty-icon">ğŸ”¥</div>
      <h2>No hay tendencias disponibles</h2>
      <p>Intenta mÃ¡s tarde</p>
    </div>

    <!-- Movies Grid -->
    <div *ngIf="!isLoadingTrending && trendingRecommendations && trendingRecommendations.length > 0" class="movies-grid">
      <div *ngFor="let movie of trendingRecommendations" class="movie-card">
        <div class="movie-poster" [routerLink]="['/movies/detail', movie.movie_tmdb_id]">
          <img 
            *ngIf="movie.poster_path" 
            [src]="getImageUrl(movie.poster_path)" 
            [alt]="movie.title"
          />
          <div *ngIf="!movie.poster_path" class="no-poster">ğŸ¬</div>

          <div class="movie-overlay">
            <div class="movie-rating" *ngIf="movie.vote_average">
              â­ {{ movie.vote_average.toFixed(1) }}
            </div>
          </div>
        </div>

        <div class="movie-info">
          <h3 [routerLink]="['/movies/detail', movie.movie_tmdb_id]">{{ movie.title }}</h3>
          <p class="movie-year" *ngIf="movie.release_date">
            {{ movie.release_date.substring(0, 4) }}
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- GENRE TAB -->
  <div *ngIf="selectedTab === 'genre'">
    <!-- Loading -->
    <div *ngIf="isLoadingGenre" class="loading">
      <div class="spinner"></div>
      <p>Cargando por gÃ©nero favorito...</p>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoadingGenre && (!genreRecommendations || genreRecommendations.length === 0)" class="empty-state">
      <div class="empty-icon">ğŸ­</div>
      <h2>AÃºn no tenemos suficiente informaciÃ³n</h2>
      <p>Califica pelÃ­culas para que identifiquemos tu gÃ©nero favorito</p>
    </div>

    <!-- Movies Grid -->
    <div *ngIf="!isLoadingGenre && genreRecommendations && genreRecommendations.length > 0" class="movies-grid">
      <div *ngFor="let movie of genreRecommendations" class="movie-card">
        <div class="movie-poster" [routerLink]="['/movies/detail', movie.movie_tmdb_id]">
          <img 
            *ngIf="movie.poster_path" 
            [src]="getImageUrl(movie.poster_path)" 
            [alt]="movie.title"
          />
          <div *ngIf="!movie.poster_path" class="no-poster">ğŸ¬</div>

          <div class="movie-overlay">
            <div class="movie-rating" *ngIf="movie.vote_average">
              â­ {{ movie.vote_average.toFixed(1) }}
            </div>
          </div>
        </div>

        <div class="movie-info">
          <h3 [routerLink]="['/movies/detail', movie.movie_tmdb_id]">{{ movie.title }}</h3>
          <p class="movie-year" *ngIf="movie.release_date">
            {{ movie.release_date.substring(0, 4) }}
          </p>
        </div>
      </div>
    </div>
  </div>

</div>