<app-navbar></app-navbar>

<div class="feed-container">
  <div class="feed-header">
    <h1>Feed Social</h1>
    <p>Bienvenido, <strong>{{ currentUser?.username }}</strong>! üéâ</p>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading">
    <div class="spinner"></div>
    <p>Cargando feed...</p>
  </div>

  <!-- Feed Content -->
  <div *ngIf="!isLoading" class="feed-content">
    
    <!-- Empty State -->
    <div *ngIf="feedItems.length === 0" class="empty-state">
      <h2>No hay actividad todav√≠a</h2>
      <p>Empieza a calificar pel√≠culas y seguir usuarios para ver contenido aqu√≠</p>
      <button class="btn btn-primary" routerLink="/movies/search">
        Explorar Pel√≠culas
      </button>
    </div>

    <!-- Feed Items -->
    <div *ngFor="let item of feedItems" class="post-card">
      
      <!-- Post Header -->
      <div class="post-header">
        <div class="user-info">
          <div class="avatar">{{ getUserInitial(item.user.username) }}</div>
          <div class="user-details">
            <span class="username">{{ item.user.username }}</span>
            <span class="time">{{ getTimeAgo(item.created_at) }}</span>
          </div>
        </div>
      </div>

      <!-- Rating Post -->
      <div *ngIf="item.activity_type === 'rating'" class="post-body">
        <div class="activity-header">
          <span class="activity-icon">‚≠ê</span>
          <span class="activity-text">Calific√≥ una pel√≠cula</span>
        </div>

        <div class="movie-card-inline" [routerLink]="['/movies/detail', item.movie_tmdb_id]">
          <img 
            *ngIf="item.movie_poster" 
            [src]="getImageUrl(item.movie_poster)" 
            [alt]="item.movie_title"
            class="movie-thumb"
          />
          <div class="movie-info">
            <h3>{{ item.movie_title }}</h3>
            <div class="rating-display large">
              ‚≠ê {{ item.rating?.toFixed(1) }}/5
            </div>
          </div>
        </div>
      </div>

      <!-- Review Post -->
      <div *ngIf="item.activity_type === 'review'" class="post-body">
        <div class="activity-header">
          <span class="activity-icon">üìù</span>
          <span class="activity-text">Escribi√≥ una rese√±a</span>
        </div>

        <div class="movie-card-inline" [routerLink]="['/movies/detail', item.movie_tmdb_id]">
          <img 
            *ngIf="item.movie_poster" 
            [src]="getImageUrl(item.movie_poster)" 
            [alt]="item.movie_title"
            class="movie-thumb"
          />
          <div class="movie-info">
            <h3>{{ item.movie_title }}</h3>
            <h4 *ngIf="item.review_title" class="review-title">{{ item.review_title }}</h4>
            <p class="review-preview">{{ item.review_content }}</p>
            <span *ngIf="item.review_contains_spoilers" class="spoiler-badge">
              ‚ö†Ô∏è Contiene Spoilers
            </span>
          </div>
        </div>
      </div>

      <!-- List Post -->
      <div *ngIf="item.activity_type === 'list_created'" class="post-body">
        <div class="activity-header">
          <span class="activity-icon">üìã</span>
          <span class="activity-text">Cre√≥ una lista</span>
        </div>

        <div class="list-card" [routerLink]="['/lists/detail', item.list_id]">
          <h3>{{ item.list_name }}</h3>
          <p *ngIf="item.list_description" class="list-description">
            {{ item.list_description }}
          </p>
        </div>
      </div>

      <!-- Interactions Component -->
      <app-feed-interactions
        [targetType]="item.activity_type === 'list_created' ? 'list' : item.activity_type"
        [targetId]="item.target_id"
        [movieTitle]="item.movie_title"
      ></app-feed-interactions>

    </div>
  </div>

  <!-- Pagination -->
  <div *ngIf="!isLoading && feedItems.length > 0 && totalPages > 1" class="pagination">
    <button 
      class="page-btn"
      [disabled]="currentPage === 1"
      (click)="changePage(currentPage - 1)"
    >
      ‚Üê Anterior
    </button>

    <button
      *ngFor="let page of getPages()"
      class="page-btn"
      [class.active]="page === currentPage"
      (click)="changePage(page)"
    >
      {{ page }}
    </button>

    <button 
      class="page-btn"
      [disabled]="currentPage === totalPages"
      (click)="changePage(currentPage + 1)"
    >
      Siguiente ‚Üí
    </button>
  </div>
</div>