<app-navbar></app-navbar>

<div class="list-detail-container">
  <!-- Loading -->
  <div *ngIf="isLoading" class="loading">
    <div class="spinner"></div>
    <p>Cargando lista...</p>
  </div>

  <!-- List Content -->
  <div *ngIf="!isLoading && list" class="list-content">
    
    <!-- Header -->
    <div class="list-header">
      <button class="btn-back" (click)="goBack()">
        â† Volver
      </button>

      <div class="header-content">
        <!-- View Mode -->
        <div *ngIf="!isEditMode" class="view-mode">
          <h1>{{ list.name }}</h1>
          <p class="description" *ngIf="list.description">{{ list.description }}</p>
          
          <div class="list-meta">
            <span class="movies-count">
              ğŸ¬ {{ list.movies_count }} {{ list.movies_count === 1 ? 'pelÃ­cula' : 'pelÃ­culas' }}
            </span>
            <span class="visibility" [class.public]="list.is_public">
              {{ list.is_public ? 'ğŸŒ PÃºblica' : 'ğŸ”’ Privada' }}
            </span>
            <span class="date">
              ğŸ“… {{ list.created_at | date: 'dd/MM/yyyy' }}
            </span>
          </div>
        </div>

        <!-- Edit Mode -->
        <div *ngIf="isEditMode" class="edit-mode">
          <div class="form-group">
            <label>Nombre</label>
            <input 
              type="text" 
              [(ngModel)]="editName"
              placeholder="Nombre de la lista"
            />
          </div>
          
          <div class="form-group">
            <label>DescripciÃ³n</label>
            <textarea 
              [(ngModel)]="editDescription"
              placeholder="DescripciÃ³n (opcional)"
              rows="3"
            ></textarea>
          </div>
        </div>

        <!-- Actions -->
        <div class="header-actions">
          <button 
            *ngIf="!isEditMode" 
            class="btn btn-secondary"
            (click)="toggleEditMode()"
          >
            âœï¸ Editar
          </button>
          
          <button 
            *ngIf="!isEditMode" 
            class="btn btn-danger"
            (click)="deleteList()"
          >
            ğŸ—‘ï¸ Eliminar Lista
          </button>

          <button 
            *ngIf="isEditMode" 
            class="btn btn-secondary"
            (click)="toggleEditMode()"
          >
            Cancelar
          </button>
          
          <button 
            *ngIf="isEditMode" 
            class="btn btn-primary"
            (click)="saveChanges()"
            [disabled]="isSaving"
          >
            {{ isSaving ? 'Guardando...' : 'Guardar Cambios' }}
          </button>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="movies.length === 0" class="empty-state">
      <div class="empty-icon">ğŸ¬</div>
      <h2>Lista vacÃ­a</h2>
      <p>AÃºn no has agregado pelÃ­culas a esta lista</p>
      <button class="btn btn-primary" routerLink="/movies/search">
        Buscar PelÃ­culas
      </button>
    </div>

    <!-- Movies Grid -->
    <div *ngIf="movies.length > 0" class="movies-grid">
      <div 
        *ngFor="let movie of movies" 
        class="movie-card"
      >
        <div class="movie-poster" [routerLink]="['/movies/detail', movie.movie_tmdb_id]">
          <img 
            *ngIf="movie.details?.poster_path" 
            [src]="getImageUrl(movie.details.poster_path)" 
            [alt]="movie.details?.title"
          />
          <div *ngIf="!movie.details?.poster_path" class="no-poster">
            ğŸ¬
          </div>
          
          <div class="movie-overlay">
            <div class="movie-rating" *ngIf="movie.details?.vote_average">
              â­ {{ (movie.details.vote_average / 2).toFixed(1) }}
            </div>
          </div>
        </div>

        <div class="movie-info">
          <h3 [routerLink]="['/movies/detail', movie.movie_tmdb_id]">
            {{ movie.details?.title || 'Cargando...' }}
          </h3>
          <p class="movie-year" *ngIf="movie.details?.release_date">
            {{ movie.details.release_date.substring(0, 4) }}
          </p>
          <p class="added-date">
            Agregada: {{ movie.added_at | date: 'dd/MM/yyyy' }}
          </p>
        </div>

        <button 
          class="btn-remove"
          (click)="removeMovie(movie, $event)"
          title="Eliminar de la lista"
        >
          âœ•
        </button>
      </div>
    </div>
  </div>
</div>